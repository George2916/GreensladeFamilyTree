!function($,e,t){var i=1,n=3,a=["p","div","pre","form"],o=27,s=9,r=[8,9,17,18,37,38,39,40,91,46];$.emojiarea={assetsPath:"",spriteSheetPath:"",blankGifPath:"",iconSize:25,icons:{}};var c=":joy:,:kissing_heart:,:heart:,:heart_eyes:,:blush:,:grin:,:+1:,:relaxed:,:pensive:,:smile:,:sob:,:kiss:,:unamused:,:flushed:,:stuck_out_tongue_winking_eye:,:see_no_evil:,:wink:,:smiley:,:cry:,:stuck_out_tongue_closed_eyes:,:scream:,:rage:,:smirk:,:disappointed:,:sweat_smile:,:kissing_closed_eyes:,:speak_no_evil:,:relieved:,:grinning:,:yum:,:laughing:,:ok_hand:,:neutral_face:,:confused:".split(",");$.fn.emojiarea=function(e){return e=$.extend({},e),this.each(function(){var i=$(this);if("contentEditable"in t.body&&!1!==e.wysiwyg){var n=getGuid();new u(i,n,$.extend({},e))}else{var n=getGuid();new d(i,n,e)}i.attr({"data-emojiable":"converted","data-id":n,"data-type":"original-input"})})};var l={};l.restoreSelection=function(){return e.getSelection?function(t){var i=e.getSelection();i.removeAllRanges();for(var n=0,a=t.length;n<a;++n)i.addRange(t[n])}:t.selection&&t.selection.createRange?function(e){e&&e.select()}:void 0}(),l.saveSelection=function(){return e.getSelection?function(){var t=e.getSelection(),i=[];if(t.rangeCount)for(var n=0,a=t.rangeCount;n<a;++n)i.push(t.getRangeAt(n));return i}:t.selection&&t.selection.createRange?function(){var e=t.selection;return"none"!==e.type.toLowerCase()?e.createRange():null}:void 0}(),l.replaceSelection=function(){return e.getSelection?function(i){var n,a=e.getSelection(),o="string"==typeof i?t.createTextNode(i):i;a.getRangeAt&&a.rangeCount&&(n=a.getRangeAt(0),n.deleteContents(),n.insertNode(o),n.setStart(o,0),e.setTimeout(function(){n=t.createRange(),n.setStartAfter(o),n.collapse(!0),a.removeAllRanges(),a.addRange(n)},0))}:t.selection&&t.selection.createRange?function(e){var i=t.selection.createRange();"string"==typeof e?i.text=e:i.pasteHTML(e.outerHTML)}:void 0}(),l.insertAtCursor=function(e,i){e=" "+e;var n=i.value,a,o,s;void 0!==i.selectionStart&&void 0!==i.selectionEnd?(o=i.selectionStart,a=i.selectionEnd,i.value=n.substring(0,o)+e+n.substring(i.selectionEnd),i.selectionStart=i.selectionEnd=o+e.length):void 0!==t.selection&&void 0!==t.selection.createRange&&(i.focus(),s=t.selection.createRange(),s.text=e,s.select())},l.extend=function(e,t){if(void 0!==e&&e||(e={}),"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},l.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},l.htmlEntities=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},l.emojiInserted=function(e,t){ConfigStorage.get("emojis_recent",function(t){t=t||c||[];var i=t.indexOf(e);if(!i)return!1;-1!=i&&t.splice(i,1),t.unshift(e),t.length>42&&(t=t.slice(42)),ConfigStorage.set({emojis_recent:t})})};var h=function(){};h.prototype.setup=function(){var e=this;this.$editor.on("focus",function(){e.hasFocus=!0}),this.$editor.on("blur",function(){e.hasFocus=!1}),e.emojiMenu=new p(e),this.setupButton()},h.prototype.setupButton=function(){var e=this,t=$("[data-id="+this.id+"][data-type=picker]");t.on("click",function(t){e.emojiMenu.show(e)}),this.$button=t,this.$dontHideOnClick="emoji-picker"},h.createIcon=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=$.emojiarea.spriteSheetPath?$.emojiarea.spriteSheetPath:$.emojiarea.assetsPath+"/emoji_spritesheet_!.png",r=$.emojiarea.blankGifPath?$.emojiarea.blankGifPath:$.emojiarea.assetsPath+"/blank.gif",c=t&&Config.Mobile?26:$.emojiarea.iconSize,h=-c*a,d=-c*n,u=Config.EmojiCategorySpritesheetDimens[i][1]*c,p=Config.EmojiCategorySpritesheetDimens[i][0]*c,m="display:inline-block;";return m+="width:"+c+"px;",m+="height:"+c+"px;",m+="background:url('"+s.replace("!",i)+"') "+h+"px "+d+"px no-repeat;",m+="background-size:"+u+"px "+p+"px;",'<img src="'+r+'" class="img" style="'+m+'" alt="'+l.htmlEntities(o)+'">'},$.emojiarea.createIcon=h.createIcon;var d=function(e,t,i){this.options=i,this.$textarea=e,this.$editor=e,this.id=t,this.setup()};d.prototype.insert=function(e){$.emojiarea.icons.hasOwnProperty(e)&&(l.insertAtCursor(e,this.$textarea[0]),l.emojiInserted(e,this.menu),this.$textarea.trigger("change"))},d.prototype.val=function(){return"\n"==this.$textarea?"":this.$textarea.val()},l.extend(d.prototype,h.prototype);var u=function(i,n,a){var o=this;this.options=a||{},"unicode"===$(i).attr("data-emoji-input")?this.options.inputMethod="unicode":this.options.inputMethod="image",this.id=n,this.$textarea=i,this.emojiPopup=a.emojiPopup,this.$editor=$("<div>").addClass("emoji-wysiwyg-editor").addClass($(i)[0].className),this.$editor.data("self",this),i.attr("maxlength")&&this.$editor.attr("maxlength",i.attr("maxlength")),this.$editor.height(i.outerHeight()),this.emojiPopup.appendUnicodeAsImageToElement(this.$editor,i.val()),this.$editor.attr({"data-id":n,"data-type":"input",placeholder:i.attr("placeholder"),contenteditable:"true"});var s="blur change";this.options.norealTime||(s+=" keyup"),this.$editor.on(s,function(e){return o.onChange.apply(o,[e])}),this.$editor.on("mousedown focus",function(){t.execCommand("enableObjectResizing",!1,!1)}),this.$editor.on("blur",function(){t.execCommand("enableObjectResizing",!0,!0)});var c=this.$editor;this.$editor.on("change keydown keyup resize scroll",function(e){-1!=r.indexOf(e.which)||(e.ctrlKey||e.metaKey)&&65==e.which||(e.ctrlKey||e.metaKey)&&67==e.which||!(c.text().length+c.find("img").length>=c.attr("maxlength"))||e.preventDefault(),o.updateBodyPadding(c)}),this.$editor.on("paste",function(i){i.preventDefault();var n,a=c.attr("maxlength")-(c.text().length+c.find("img").length);(i.originalEvent||i).clipboardData?(n=(i.originalEvent||i).clipboardData.getData("text/plain"),o.options.onPaste&&(n=o.options.onPaste(n)),a<n.length&&(n=n.substring(0,a)),t.execCommand("insertText",!1,n)):e.clipboardData&&(n=e.clipboardData.getData("Text"),o.options.onPaste&&(n=o.options.onPaste(n)),a<n.length&&(n=n.substring(0,a)),t.selection.createRange().pasteHTML(n)),c.scrollTop(c[0].scrollHeight)}),i.after("<i class='emoji-picker-icon emoji-picker "+this.options.popupButtonClasses+"' data-id='"+n+"' data-type='picker'></i>"),i.hide().after(this.$editor),this.setup(),$(t.body).on("mousedown",function(){o.hasFocus&&(o.selection=l.saveSelection())})};u.prototype.updateBodyPadding=function(e){var t=$("[data-id="+this.id+"][data-type=picker]");$(e).hasScrollbar()?(t.hasClass("parent-has-scroll")||t.addClass("parent-has-scroll"),$(e).hasClass("parent-has-scroll")||$(e).addClass("parent-has-scroll")):(t.hasClass("parent-has-scroll")&&t.removeClass("parent-has-scroll"),$(e).hasClass("parent-has-scroll")&&$(e).removeClass("parent-has-scroll"))},u.prototype.onChange=function(e){var t=new CustomEvent("input",{bubbles:!0});this.$textarea.val(this.val())[0].dispatchEvent(t)},u.prototype.insert=function(e){var t,i="";if("unicode"==this.options.inputMethod)i=this.emojiPopup.colonToUnicode(e);else{var n=$(h.createIcon($.emojiarea.icons[e]));n[0].attachEvent&&n[0].attachEvent("onresizestart",function(e){e.returnValue=!1},!1),i=n[0]}this.$editor.trigger("focus"),this.selection&&l.restoreSelection(this.selection);try{l.replaceSelection(i)}catch(e){}l.emojiInserted(e,this.menu),this.onChange()},u.prototype.val=function(){for(var e=[],t=[],i=this.emojiPopup,n=function(){e.push(t.join("")),t=[]},o=function(e){if(3===e.nodeType)t.push(e.nodeValue);else if(1===e.nodeType){var i=e.tagName.toLowerCase(),s=-1!==a.indexOf(i);if(s&&t.length&&n(),"img"===i){var r=e.getAttribute("alt")||"";return void(r&&t.push(r))}"br"===i&&n();for(var c=e.childNodes,l=0;l<c.length;l++)o(c[l]);s&&t.length&&n()}},s=this.$editor[0].childNodes,r=0;r<s.length;r++)o(s[r]);t.length&&n();var c=e.join("\n");return i.colonToUnicode(c)},l.extend(u.prototype,h.prototype),jQuery.fn.hasScrollbar=function(){var e=this.get(0).scrollHeight;return this.outerHeight()<e};var p=function(i){var n=this;n.id=i.id;var a=$(t.body),o=$(e);this.visible=!1,this.emojiarea=i,p.menuZIndex=5e3,this.$menu=$("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.attr("data-id",n.id),this.$menu.attr("data-type","menu"),this.$menu.hide(),this.$itemsTailWrap=$('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu),this.$categoryTabs=$('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap),this.$itemsWrap=$('<div class="emoji-items-wrap mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap),this.$items=$('<div class="emoji-items">').appendTo(this.$itemsWrap),this.emojiarea.$editor.after(this.$menu),a.on("keydown",function(e){27!==e.keyCode&&9!==e.keyCode||n.hide()}),a.on("message_send",function(e){n.hide()}),a.on("mouseup",function(t){t=t.originalEvent||t;var i=t.target||e;if(!$(i).hasClass(n.emojiarea.$dontHideOnClick)){for(;i&&i!=e;)if((i=i.parentNode)==n.$menu[0]||n.emojiarea&&i==n.emojiarea.$button[0])return;n.hide()}}),this.$menu.on("mouseup","a",function(e){return e.stopPropagation(),!1}),this.$menu.on("click","a",function(t){if(n.emojiarea.updateBodyPadding(n.emojiarea.$editor),$(this).hasClass("emoji-menu-tab"))return n.getTabIndex(this)!==n.currentCategory&&n.selectCategory(n.getTabIndex(this)),!1;var i=$(".label",$(this)).text();return e.setTimeout(function(){n.onItemSelected(i),(t.ctrlKey||t.metaKey)&&n.hide()},0),t.stopPropagation(),!1}),this.selectCategory(0)};p.prototype.getTabIndex=function(e){return this.$categoryTabs.find(".emoji-menu-tab").index(e)},p.prototype.selectCategory=function(e){var t=this;this.$categoryTabs.find(".emoji-menu-tab").each(function(t){t===e?this.className+="-selected":this.className=this.className.replace("-selected","")}),this.currentCategory=e,this.load(e)},p.prototype.onItemSelected=function(e){this.emojiarea.$editor.text().length+this.emojiarea.$editor.find("img").length>=this.emojiarea.$editor.attr("maxlength")||this.emojiarea.insert(e)},p.prototype.load=function(e){var t=[],i=$.emojiarea.icons,n=$.emojiarea.assetsPath,a=this;n.length&&"/"!==n.charAt(n.length-1)&&(n+="/");var o=function(){a.$items.html(t.join(""))};if(e>0){for(var s in i)i.hasOwnProperty(s)&&i[s][0]===e-1&&t.push('<a href="javascript:void(0)" title="'+l.htmlEntities(s)+'">'+h.createIcon(i[s],!0)+'<span class="label">'+l.htmlEntities(s)+"</span></a>");o()}else ConfigStorage.get("emojis_recent",function(e){e=e||c||[];var n,a;for(a=0;a<e.length;a++)n=e[a],i[n]&&t.push('<a href="javascript:void(0)" title="'+l.htmlEntities(n)+'">'+h.createIcon(i[n],!0)+'<span class="label">'+l.htmlEntities(n)+"</span></a>");o()})},p.prototype.hide=function(e){this.visible=!1,this.$menu.hide("fast")},p.prototype.show=function(e){if(this.visible)return this.hide();$(this.$menu).css("z-index",++p.menuZIndex),this.$menu.show("fast"),this.currentCategory||this.load(0),this.visible=!0}}(jQuery,window,document);