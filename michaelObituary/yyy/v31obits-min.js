var extraPendingReview="",tabLoadListeners=new Array,fbLogonWindowListener=!1;function initV31Obit(){$("#obcoreV3 .navcell31").click(function(){$("#obcoreV3 .navcell31").removeClass("nav-selected"),$(this).addClass("nav-selected"),onNavSection($(this).attr("data-tag"))}),$("#v31obpg").on("click",".btn-snfl",function(){obFlowerPanel()}),$("#v31obpg .btn-rsvp-svc").click(function(){rsvpToService($(this))}),$("#v31obpg .btn-streaming-svc").click(function(){$("#spmusic").length&&stopBGMusic()}),$("#v31obpg").on("click",".btn-snfl",function(){var t=$(this).attr("data-tag");$(".obitnavtabs ."+t).click()}),$("#v31obpg .sbgblink").click(function(){$("#obcontent").addClass("show-trib-entry");var t=$(this).attr("data-tag");$(".obitnavtabs ."+t).click()}),$("a.btn-print").click(function(){$("#dlgprint").length>0&&$("#dlgprint").remove();var t=$(this).attr("data-ok"),e=$(this).attr("data-bg"),s=$(this).attr("data-fcf");axpost("/pax/prnobit","ok="+t+"&fcf="+s+"&bg="+e,function(t){$("#pubdyncnt").html(t)})}),$(".obit-sharing .fbshare").click(function(){var t=$(this).attr("data-url");window.open("http://www.facebook.com/sharer.php?u="+t,"Facebook","toolbar=0,status=0,width=640,height=440")}),$(".obit-sharing .btn-twitter").click(function(){encodeURIComponent(window.location);window.open("https://twitter.com/intent/tweet?text="+$(this).attr("data-twt"),"Twitter","toolbar=0,status=0,width=640,height=440")}),$("#obcoreV3").on("click",".smsdetails",function(){var t=encodeURIComponent($(this).attr("data-id"));axpost("/pax/txtsrdnr","tag="+t,function(t){$("#pubdyncnt").html(t)})}),$("#obcoreV3").on("click",".emaildetails",function(){var t=encodeURIComponent($(this).attr("data-id"));axpost("/pax/emsrdnr","tag="+t,function(t){$("#pubdyncnt").html(t)})}),$("#obcontent").on("click",".btn-os-snfl",function(){obFlowerPanel()}),$("#famlgn").length>0&&$("#famlgn").click(function(){axpost("/ajax/axsecurity.php","act=fammlgn",function(t){$("#pubdyncnt").html(t)})});var t=0;$(".cfshznav").each(function(){0==$(this).is(":hidden")&&t++}),0==t&&$("#obsidebar .rethome").css("display","inline").addClass("hidden-xs"),-1!=window.location.href.indexOf("#lightacandle")&&$("li.candles").click(),window.addEventListener("message",function(t){-1!=t.origin.indexOf("tributeslides")&&onTukiosEvent(t)},!1),initGTMEvents()}function initGTMEvents(){$('*[data-trigger="share-memory"]').click(function(){dataLayer.push({event:"gaEvent",category:"Obituary",action:"CTA Click",label:"Share a Memory"})})}function rsvpToService(t){var e=t.attr("data-en");axpost("/pax/svcrsvp","en="+e,function(t){$("#pubdyncnt").html(t)})}function initRSVPToSvcDlg(){$("#fmrsvp").submit(function(t){return t.preventDefault(),!1}),$("#dlgrsvptosvc input[name=rsvpoption]").click(function(){$("#rsvpopts").show(),1==$(this).val()?$("#dlgrsvptosvc .att-flds").show():$("#dlgrsvptosvc .att-flds").hide()}),1==$("#dlgrsvptosvc input[name=rsvpoption]:checked").val()?$("#dlgrsvptosvc .att-flds").show():$("#dlgrsvptosvc .att-flds").hide(),$("#dorsvp").click(function(){validateRSVPFieldsAndSave()}),$("#dlgrsvptosvc").modal("show")}function validateRSVPFieldsAndSave(){if($("#dlgrsvptosvc div.form-group").removeClass("has-error"),$("#rsvpstatus").hide(),$("#rsvpstatus").text("Please correct the field highlighted in red and try again"),0==$("#dlgrsvptosvc input[name=rsvpoption]:checked").length)return $("#rsvpfl1").addClass("has-error"),void $("#rsvpstatus").show();if(""==$("#dlgrsvptosvc input[name=name]").val().trim())return $("#rsvpfl2").addClass("has-error"),$("#dlgrsvptosvc input[name=name]").focus(),void $("#rsvpstatus").show();if(""==$("#dlgrsvptosvc input[name=email]").val().trim())return $("#rsvpfl3").addClass("has-error"),$("#dlgrsvptosvc input[name=email]").focus(),void $("#rsvpstatus").show();if(""==$("#dlgrsvptosvc input[name=phone]").val().trim())return $("#rsvpfl4").addClass("has-error"),$("#dlgrsvptosvc input[name=phone]").focus(),void $("#rsvpstatus").show();var t=$("#dlgrsvptosvc").attr("data-en"),e=$("#attendees").val(),s=$("#noslots").length?-1:$("#timeslot").val(),a=$("#rsvpemail").val();axpost("/pax/svcrsvpck","dt="+t+"&g="+e+"&s="+s+"&em="+a,function(e){"OK"!=e?(axpost("/pax/svcrsvpsl","dt="+t+"&ix="+s,function(t){$("#timeslot").html(t)}),alert("Your party cannot be accommodated.  Please review the current availability"),$("#rsvpfl5").addClass("has-error")):postRSVPForm()})}function postRSVPForm(){var t=$("#fmrsvp"),e=$("#dlgrsvptosvc").attr("data-en"),s=$("#dlgrsvptosvc").attr("data-id"),a=$("#noslots").length?-1:$("#timeslot option:selected").attr("data-tm"),o=($("#dlgrsvptosvc input[name=rsvpoption]:checked").val(),t.serialize());axpost("/pax/svcrsvpds","dt="+e+"&ts="+a+"&uid="+s+"&"+o,function(t){"AOK"==t?($("#dlgrsvptosvc").modal("hide"),location.reload(!0)):"BADEMAIL"==t?($("#rsvpstatus").text("Please check your email address before continuing"),$("#rsvpstatus").show()):"ERROR"!=t&&($("#dlgrsvptosvc").modal("hide"),$("#pubdyncnt2").html(t))})}function initRSVPUpdateConf(){$("#cmdrsvpconf").click(function(){var t=$("#rsvpupconf").attr("data-hs"),e=$("#rsvpcodefld").val();if(rsvpStringHash(e)==t){var s=$("#rsvpupconf").attr("data-en"),a=$("#rsvpupconf").attr("data-cen");axpost("/pax/dorsvpconf","cen="+a+"&en="+s+"&uv="+e,function(t){$("#rsvpupconf").modal("hide"),$("#pubdyncnt").html(t)})}else alert("Incorrect code.  Please check your email")}),$("#rsvpupconf").modal("show")}function initSMSDialog31(){$("#dlgtext31").modal("show"),$("#fmodtxt").submit(function(t){if(t.preventDefault(),$("#smsfmgrp").removeClass("has-error"),""!=$("#txtnum").val()){var e=$("#fmodtxt").serialize();return axpost("/pax/dotxtsrdnr",e,function(t){"OK"==t?($("#dlgtext31").modal("hide"),showServiceDlgSent()):($("#smsfmgrp").addClass("has-error"),$("#ocstatus").text("Text not sent.  Please check the number."))}),!1}$("#smsfmgrp").addClass("has-error")})}function initEmailDialog(){$("#dlgemail").modal("show"),$("#fmodemail").submit(function(t){if(t.preventDefault(),$("#emfmgrp").removeClass("has-error"),""!=$("#emails").val()){var e=$("#fmodemail").serialize();return axpost("/pax/doemsrdnr",e,function(t){"OK"==t?($("#dlgemail").modal("hide"),showServiceDlgSent()):($("#emfmgrp").addClass("has-error"),$("#ocstatus").text("Email not sent.  Please check the addresses."))}),!1}$("#emfmgrp").addClass("has-error")})}function showServiceDlgSent(){$("#obsidebar button.btn-tree").length&&($("#dlgsent31 div.generic").hide(),$("#dlgsent31 div.tree-generic").show()),$("#dlgsent31").modal("show")}function obFlowerPanel(){var t=window.location.href+"/sympathy";window.location=t}function onTukiosEvent(t){var e=t.data.type;"play"==e?stopBGMusic():"pause"==e&&startBGMusic()}function onNavSection(t){var e=$("#sn-"+t),s=e.attr("data-ld");if($("#obcontent .obsn").hide(),e.show(),$("#obsidebar").attr("class",""),$("#obsidebar").addClass(t),1!=s){e.html('<h3 class="text-center">Loading, please wait...</h3>');var a=$("#obitsbarV31").attr("data-oid");axpost("/pax/obpgsnvn","sn="+t+"&oid="+a,function(s){e.html(s),e.attr("data-ld",1),$.each(tabLoadListeners,function(e,s){s(t)})})}}function initTributeWall(){$(window),$(document);$("#enter-tribute").click(function(){$("#obcontent").addClass("show-trib-entry")}),$(window).scroll(function(){checkPaging()}),$("#wallopts li").click(function(){switch($(this).attr("data-op")){case"multimedia":addMedia();break;case"embedvid":embedVideo();break;case"candle":showGestures($(this),"candles");break;case"sentiment":showGestures($(this),"sentiments");break;case"flowers":sendFlowers()}}),$("#twrmgest").click(function(){$("#gsid").val(0),$("#twcgest").hide(),$("#twctext").removeClass("col-xs-9 col-sm-10").addClass("col-xs-12"),$("#twctext .tribute-field").attr("placeholder","Please share your remembrances and condolences")}),$("#emytclose").click(function(t){return t.preventDefault(),$("#embedyoutube").hide(),$("#wallopts .emvd").removeClass("selected"),!1}),$("#ytlink").bind("paste",function(t){doEmbedVideo(t.originalEvent.clipboardData.getData("text"))}),$("#embedyt").click(function(){doEmbedVideo($("#ytlink").val())}),$("#twrmvid").click(function(){$("#ytvid").val(""),$("#emvidpreview .videopreview").html(),$("#emvidpreview").hide()}),$("#tribtext").focus(function(){showTribSubFields()}),$("#twctext div.tribute-field").focus(function(){showTribSubFields()}),$("#addtrib").click(function(t){t.preventDefault(),$("#addtrib").hide();var e=$("#fmtribpost").serialize();return axpost("/pax/twusrinf",e,function(t){$("#pubdyncnt").html(t)}),!1}),$("#cncrep").click(function(t){return t.preventDefault(),cancelComment(),!1}),$("#sn-tributewall").on("click",".btn-comment",function(){commentOnPost($(this))}),$("#sn-tributewall").on("click",".btn-viewgallery",function(){showGallery()}),$("#sn-tributewall").on("click","div.vwallgu",function(){showAllPostUploads($(this))}),$("#twgallery .notice-banner").click(function(){showTributeWall()}),"photo-album"==$(location).attr("href").split("/").pop()&&showGallery()}function showGallery(){if($("#twlzone").hide(),$("#twgallery").show(),0==$("#twgallery").attr("data-ld")){var t=$("#obitsbarV31").attr("data-oid");$("#twgallery").attr("data-ld",1),axpost("/pax/twshgal","oid="+t,function(t){$("#twgalarea").html(t)})}}function showAllPostUploads(t){var e=t.attr("data-id"),s=t.closest("div.row");axpost("/pax/vwallgu","dt="+e,function(t){s.html(t)})}function showTributeWall(){$("#twlzone").show(),$("#twgallery").hide()}function commentOnPost(t){var e=t.closest(".untwpost").find(".reparea");$("#fmtribpost").appendTo(e),$("#replid").val(t.attr("data-id")),$("#addtrib").text("Post Comment"),$("#cncrep").show(),showTribSubFields()}function cancelComment(){if(!$("#fmtribpost").parent().is(".tphldr")){var t=$("#twfmarea");$("#fmtribpost").appendTo(t),$("#replid").val(""),$("#addtrib").text("Save Post"),$("#cncrep").hide()}}var tribPagePending=!1,nextPostID=0,buttonPosY=0;function checkPaging(){var t=$(window);$(document);1!=tribPagePending&&0!=nextPostID&&t.scrollTop()+t.height()>buttonPosY&&(tribPagePending=!0,renderNextPostsPage())}function renderNextPostsPage(){var t=$("#obitsbarV31").attr("data-oid"),e=$("#twlzone").attr("data-pgba");axpost("/pax/twposts","oid="+t+"&stid="+nextPostID+"&pvgbkey="+e,function(t){$("#p"+nextPostID).html(t),tribPagePending=!1})}function initTWUserInfo(){0==fbLogonWindowListener&&(fbLogonWindowListener=!0,window.addEventListener("message",function(t){if(-1!=t.origin.indexOf("facebook.runcfs.com")){var e=t.data;$("#twusrfb").val(e),submitTWPost()}},!1)),$("#addtrib").show(),$("#dlgtwusr").modal("show"),$("#fmocmsg").submit(function(t){return t.preventDefault(),!1}),$("#twsvpost").click(function(t){t.preventDefault(),$("#ocemail").val($("#ocemail").val().trim()),$("#twsvpost").hide();var e=$("#fmocmsg"),s=!0;return 1==$("#caer").val()&&(e.bootstrapValidator({submitHandler:function(t,e,s){return!1}}),e.data("bootstrapValidator").resetForm(),e.data("bootstrapValidator").validate(),s=e.data("bootstrapValidator").isValid()),s?submitTWPost():$("#twsvpost").show(),!1})}function submitTWPost(){var t=$("#tribtext").val().replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"");$("#tribtext").val(t);var e=$("#fmocmsg").serialize(),s=$("#fmtribpost").serialize();axpost("/pax/twdoaddpost",e+"&"+s,function(t){if(-1==t.indexOf("cfsjsrtdt"))return $("#ocstatus").html(t),$("#caer").val(0),void $("#twsvpost").show();var e=JSON.parse(t);if("OK"==e.result){twResetForm();var s=$("#sn-tributewall").attr("data-conftxt"),a=void 0===s?"Thank you.  Your submission will be published, once reviewed. ":s;$("#dlgtwusr").modal("hide"),$("#twstatus").html('<span class="label label-default label-cfs" style="white-space:normal">'+a+extraPendingReview+"</span>")}else"Refresh"==e.result?(twResetForm(),$("#dlgtwusr").modal("hide"),$("#twstatus").html('<span class="label label-default label-cfs">Thank you.  Your submission has been published.</span>'),refreshWall()):($("#ocstatus").html(t),$("#caer").val(0),$("#twsvpost").show())})}function twResetForm(){$("#twrmvid").click(),$("#emytclose").click(),$("#twrmvid").click(),$("#twrmgest").click(),$("#tribtext").val(""),$("#twctext div.tribute-field").text(""),$("#twctext div.tribute-field").css("height","25px"),$("#tribsubrow").hide(),cancelComment()}function doEmbedVideo(t){var e=isYouTube(t);if(!1!==e){$("#ytlink").val(""),$("#ytvid").val(e),embedVideo(),showTribSubFields();var s='<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" src="'+("https://www.youtube.com/embed/"+e)+'" allowfullscreen></iframe></div>';$("#emvidpreview .videopreview").html(s),$("#emvidpreview").show()}}function isYouTube(t){var e=t.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return e&&11==e[2].length?e[2]:!(!e||'"'!=e[2][11])&&e[2].substring(0,11)}function showTribSubFields(){1==$("#tribtext").attr("rows")&&$("#tribtext").attr("rows",4),$("#twctext div.tribute-field").css("height","100px"),$("#tribsubrow").show()}function addMedia(t){}function embedVideo(){var t=$("#wallopts .emvd");if(t.is(".selected"))return t.removeClass("selected"),void $("#embedyoutube").hide();closeGestures(),$("#embedyoutube").show(),$("#wallopts li").removeClass("selected"),t.addClass("selected")}function showGestures(t,e){var s=$("#gesturelist").attr("data-tp");if($("#embedyoutube").hide(),e==s)return $("#gesturelistpt").toggle(),t.toggleClass("selected"),void $("#wallopts .emvd").removeClass("selected");$("#gesturelistpt").show(),$("#wallopts li").removeClass("selected"),t.addClass("selected"),e!=s&&($("#gesturelist").html("Loading, please wait..."),axpost("/pax/twgest","tp="+e,function(t){$("#gesturelist").html(t),$("#gesturelist").attr("data-tp",e)}))}function initTWGestures(){$("#twgestures .item").click(function(){var t=$(this).attr("data-id"),e=$(this).find("img").clone();e.addClass("img-responsive").css("max-height","120px"),$("#gsid").val(t),$("#twcgest .twprev").html(""),$("#twcgest .twprev").append(e),$("#twcgest").show(),$("#twctext").removeClass("col-xs-12").addClass("col-xs-9 col-sm-10"),closeGestures(),showTribSubFields(),$("#twctext .tribute-field").attr("placeholder","Optionally add a message to accompany your gesture or click 'Save Post' to add your name and make your posting")}),$("#twgestures").owlCarousel({loop:!0,margin:10,responsive:{0:{items:4},600:{items:8},1000:{items:10}}}),$("#twhdgest").click(function(t){return t.preventDefault(),closeGestures(),!1})}function closeGestures(){$("#wallopts .gestures").removeClass("selected"),$("#gesturelistpt").hide()}function refreshWall(){var t=$("#obitsbarV31").attr("data-oid");axpost("/pax/twposts","oid="+t+"&stid=0",function(t){$("#twlzone").html(t)})}function sendFlowers(){}