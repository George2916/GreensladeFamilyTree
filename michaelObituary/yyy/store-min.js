function storepost(t,a,e,r){var s=$("#"+t).attr("data-nl"),i=$("#"+t).attr("data-cid"),o=$("#"+t).closest(".inplace").attr("id");""!==spfx?$.post("/"+spfx+"/store/"+a,"rid="+t+"&sn="+cfssid+"&ctx="+i+"&"+e+"&hid="+o+"&nl="+s+"&d="+encodeURIComponent(window.location),r):$.post("/store/"+a,"rid="+t+"&sn="+cfssid+"&ctx="+i+"&"+e+"&hid="+o+"&nl="+s+"&d="+encodeURIComponent(window.location),r)}function initStoreList(t){$("#"+t+" .viewcat").click((function(){return showCategory(t,$(this).attr("data-lid"),$(this).attr("data-cid")),!1})),$("#"+t+" .orderprod").click((function(){return orderProduct(t,$(this)),!1})),$("#"+t+" .cart-summary").click((function(){return showCart(t,$(this).attr("data-l"),$(this).attr("data-c")),!1})),$("#"+t).on("click",".step",(function(){return checkoutStep(t,$(this).attr("data-s"),$(this).attr("data-p")),!1})),$("#"+t+" a.alllines").click((function(a){a.preventDefault();var e=$("#"+t).closest(".inplace").attr("id");return axpost("/pax/alllines","htmlid="+e+"&rid="+t,(function(a){$("#"+t).html(a)})),!1}))}function initCardMessage(t){var a=$("#fmcardmsg");$("input[name=optinstructions]").click((function(){1==$(this).val()?$("#instructions").show():$("#instructions").hide()})),$("#cardmsg").keyup((function(){updateCardMessageTally(t)})),updateCardMessageTally(t),$("#cardmsg").focus((function(){$("#nocmtext").hide()})),$("#nextstep").click((function(){var e=$(this).closest(".sitestore").attr("id"),r;if($("#cardmsg").val().length>t)alert("Unfortunately, your message is too long to fit onto the card.  Please trim it down to no more than "+t+" characters (as indicated in the tally below the message area).");else{if(""==$("#cardmsg").val()&&1==a.attr("data-cma")){var s=$("#nocmtext");if(0==s.attr("data-warned"))return s.attr("data-warned",1),void s.show()}var i=$(this).attr("data-s"),o=$(this).attr("data-p"),d=$(this).attr("data-ts");storepost(e,"stepreturn","step="+d+"&"+a.serialize(),(function(t){"OK"==t&&storepost(e,"ck","step="+i+"&puid="+o,(function(t){$("#"+e).html(t)}))}))}}))}function updateCardMessageTally(t){var a=$("#cardmsg").val().length;a>t?$("#charleft").text(a+" - Exceeded Limit"):$("#charleft").text(t-a),a>t-50?$("#charleft").css("color","#c00"):$("#charleft").css("color","inherit")}function initDeliveryAndDate(){var t=$("#fmdelivery");$("#curaddr").length>0&&initAddressReuse(),t.bootstrapValidator({submitHandler:function(t,a,e){return!1}}),$("#nextstep").click((function(){var a=$(this).closest(".sitestore").attr("id");if(t.data("bootstrapValidator").validate(),0==t.data("bootstrapValidator").isValid())return!1;var e=$(this).attr("data-s"),r=$(this).attr("data-p"),s=$(this).attr("data-ts");storepost(a,"stepreturn","step="+s+"&"+t.serialize(),(function(t){"OK"==t&&storepost(a,"ck","step="+e+"&puid="+r,(function(t){$("#"+a).html(t)}))}))}))}function initAddressReuse(){$("#addresslist").change((function(){onAddressListChange()})),$("#newaddr").click((function(){setAddressRadios()})),$("#curaddr").click((function(){setAddressRadios()})),setAddressRadios()}function onAddressListChange(){var t=$("#addresslist option:selected");$("#affirst").val(decodeValue(t.attr("data-f"))),$("#aflast").val(decodeValue(t.attr("data-l"))),$("#afstreet").val(decodeValue(t.attr("data-s"))),$("#afcity").val(decodeValue(t.attr("data-c"))),$("#afstate").val(decodeValue(t.attr("data-st"))),$("#afzip").val(decodeValue(t.attr("data-z"))),$("#addrkey").val(t.attr("data-id"))}function setAddressRadios(){if("existing"==$("#fmdelivery input[name=addropt]:checked").val())$("#affirst").attr("data-ov",$("#affirst").val()),$("#aflast").attr("data-ov",$("#aflast").val()),$("#afstreet").attr("data-ov",$("#afstreet").val()),$("#afcity").attr("data-ov",$("#afcity").val()),$("#afstate").attr("data-ov",$("#afstate").val()),$("#afzip").attr("data-ov",$("#afzip").val()),$("#addrkey").attr("data-ov",$("#addrkey").val()),$("#addresslist").prop("disabled",!1),$("#affirst").prop("disabled",!0),$("#aflast").prop("disabled",!0),$("#afstreet").prop("disabled",!0),$("#afcity").prop("disabled",!0),$("#afstate").prop("disabled",!0),$("#afzip").prop("disabled",!0),onAddressListChange();else{$("#affirst").val($("#affirst").attr("data-ov")),$("#aflast").val($("#aflast").attr("data-ov")),$("#afstreet").val($("#afstreet").attr("data-ov")),$("#afcity").val($("#afcity").attr("data-ov")),$("#afstate").val($("#afstate").attr("data-ov")),$("#afzip").val($("#afzip").attr("data-ov"));var t=0==$("#addrown").val()?"address":$("#addrkey").attr("data-ov");$("#addrkey").val(t),$("#addresslist").prop("disabled",!0),$("#affirst").prop("disabled",!1),$("#aflast").prop("disabled",!1),$("#afstreet").prop("disabled",!1),$("#afcity").prop("disabled",!1),$("#afstate").prop("disabled",!1),$("#afzip").prop("disabled",!1)}}function initServiceDelivery(){$(".servicetarget").click((function(){$(".servicetarget").removeClass("cfsck"),$(this).addClass("cfsck"),$("#delivery").val($(this).attr("data-key"))})),$("#nextstep").click((function(){var t=$("#fmsvcdelivery"),a=$(this).closest(".sitestore").attr("id");if(t.bootstrapValidator({submitHandler:function(t,a,e){return!1}}),t.data("bootstrapValidator").validate(),0==t.data("bootstrapValidator").isValid())return!1;var e=$(this).attr("data-s"),r=$(this).attr("data-p"),s=$(this).attr("data-ts");storepost(a,"stepreturn","step="+s+"&"+$("#fmsvcdelivery").serialize(),(function(t){"OK"==t&&storepost(a,"ck","step="+e+"&puid="+r,(function(t){$("#"+a).html(t)}))}))}))}function initPublishOptions(){$("input[name=pubopt]").click((function(){setPubPreviewState()})),setPubPreviewState(),$("#pubfrom").keyup((function(){$("#sentby").text($("#pubfrom").val())})),$("#nextstep").off(),$("#nextstep").click((function(){var t=$("#fmpubopts"),a=$(this).closest(".sitestore").attr("id");if(t.bootstrapValidator({submitHandler:function(t,a,e){return!1}}),t.data("bootstrapValidator").validate(),0==t.data("bootstrapValidator").isValid())return!1;var e=$(this).attr("data-s"),r=$(this).attr("data-p"),s=$(this).attr("data-ts");storepost(a,"stepreturn","step="+s+"&"+t.serialize(),(function(t){"OK"==t&&storepost(a,"ck","step="+e+"&puid="+r,(function(t){$("#"+a).html(t)}))}))}))}function setPubPreviewState(){var t=$("input[name=pubopt]:checked").val();1==t?$("#pubfm").show():$("#pubfm").hide(),0==t?($("#pubfm").hide(),$("#pubpreview").hide()):1==t?($("#pubfm").show(),$("#pv1").show(),$("#pv2").hide(),$("#pubpreview").show()):2==t&&($("#pubfm").hide(),$("#pv1").hide(),$("#pv2").show(),$("#pubpreview").show())}function initSummaryPage(t,a){resetSubordinateStore(t),$(".changeprod").click((function(){checkoutStep(t,"review",$(this).attr("data-p"))})),$(".removeprod").click((function(){confirm("Are you sure that you want to permanently remove this item from your order?")&&checkoutStep(t,"remove",$(this).attr("data-p"))})),$("#schelp").popover({html:!1,placement:"top",trigger:"hover",title:"Explanation",content:"This item covers the costs associated with processing your order and passing it to our local florist."}),analytics("Sales","Checkout"+a),setupPaymentForm(),$("#cmdsubmit").click((function(t){if(t.preventDefault(),0==onSubmitPaymentForm())return!1;var e=$("#fmpayment");if(e.formValidation(),e.data("formValidation").validate(),0==e.data("formValidation").isValid())return $("#pmtstatus").html("Please check the fields in red and click on 'Place Order' when done."),$("#cmdsubmit").prop("disabled",!1),!1;var r=e.closest(".sitestore").attr("id");return $("#pmtstatus").text("Processing payment - please wait..."),$("#pmtstatus").show(),storepost(r,"ck","step=placeorder&"+e.serialize(),(function(t){try{var e=JSON.parse(t);$("#cmdsubmit").prop("disabled",!0),"OK"==e.result?($("#"+r).html(e.html),analytics("Sales","OrderPlaced"+a)):($("#pmtstatus").html(e.html),$("#pmtstatus").show(),$("#cmdsubmit").prop("disabled",!1),onPaymentError())}catch(a){$("#pmtstatus").html("A payment error occurred"),$("#pmtstatus").show(),$("#cmdsubmit").prop("disabled",!1),onPaymentError(),axpost("/pax/reperr","dt="+encodeURIComponent(t),(function(){}))}})),!1}))}function checkoutStep(t,a,e){resetSubordinateStore(t),storepost(t,"ck","step="+a+"&puid="+e,(function(a){$("#"+t).html(a)}))}function resetSubordinateStore(t){var a;if("smobitprods"==$("#"+t).closest(".inplace").attr("id")){if(0==$("#stsndflwrs").length)return;l=$("#stsndflwrs").attr("data-flid");var e=$("#stsndflwrs .sitestore").attr("id");$("#"+e).html(""),storepost(e,"line","l="+l+"&c=0",(function(t){$("#"+e).html(t)}))}else{if(0==$("#smobitprods").length)return;var e=$("#smobitprods .sitestore").attr("id");$("#"+e).html("");var r=cfssid;axpost("/pax/alllines","htmlid=smobitprods&rid="+e,(function(t){$("#"+e).html(t),cfssid=r}))}}function showCategory(t,a,e){storepost(t,"cat","l="+a+"&c="+e,(function(a){$("#"+t).html(a)}))}function orderProduct(t,a){var e=a.attr("data-lid"),r=a.attr("data-cid"),s=a.attr("data-id"),i=a.attr("data-pp");storepost(t,"ord","l="+e+"&c="+r+"&p="+s+"&pp="+i,(function(a){$("#"+t).html(a)}))}function showCart(t,a,e){storepost(t,"cart","l="+a+"&c="+e,(function(a){$("#"+t).html(a)}))}function storeVersion(t){var a=2;return $("#"+t).length&&(storever=$("#"+t).attr("data-sver"),"undefined"!=typeof storever&&(a=storever)),a}function resetProductView(){var t;storeVersion($(".sitestore:first").attr("id"))<3?location.reload(!0):v3ReturnToProducts()}function initCart(t){$(".delprod").click((function(){var a=$("#retproducts");storepost(t,"delprod","p="+$(this).attr("data-id")+"&pp="+$(this).attr("data-pp")+"&oc="+$(this).attr("data-oc")+"&l="+a.attr("data-l")+"&c="+a.attr("data-c"),(function(a){$("#"+t).html(a)}))})),$("#checkout").click((function(){storepost(t,"ck","rn=ec",(function(a){$("#"+t).html(a)}))})),$("#retproducts").click((function(){return 3==storeVersion(t)?v3ReturnToProducts():returnToProducts($(this),t)})),$("#cartretback").click((function(){window.history.back()})),$(".cart-control").change((function(){var a=$("#retproducts");storepost(t,"qtych","p="+$(this).attr("data-id")+"&pp="+$(this).attr("data-pp")+"&oc="+$(this).attr("data-oc")+"&l="+a.attr("data-l")+"&c="+a.attr("data-c")+"&q="+$(this).val()+"&dl="+$(this).attr("data-dl"),(function(a){$("#"+t).html(a)}))})),$("#storeintro").length>0&&$("#storeintro").addClass("hidden-xs")}function returnToProducts(t,a){var e=t.attr("data-l"),r=t.attr("data-c");0==e&&0==r&&"stsndflwrs"==t.closest(".inplace").attr("id")&&(e=$("#stsndflwrs").attr("data-flid")),storepost(a,"line","l="+e+"&c="+r,(function(t){$("#"+a).html(t)}))}